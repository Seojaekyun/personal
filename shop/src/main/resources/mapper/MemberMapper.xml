<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.jk.mapper.MemberMapper">
	<select id="useridCheck" resultType="String">
		select count(*) from member where userid=#{userid}
	</select>
	<insert id="memberOk" parameterType="kr.co.jk.dto.MemberDto">
		insert into member(userid,pwd,name,email,phone,writeday)
		values(#{userid},#{pwd},#{name},#{email},#{phone},now())
	</insert>
	<select id="getProduct" resultType="HashMap">
		select * from product where pcode=#{pcode}
	</select>
	<select id="getProductAll" resultType="HashMap">
		select product.* , cart.su as csu ,datediff(now(),cart.writeday) as days
		from product inner join cart on product.pcode=cart.pcode and userid=#{userid}
	</select>
	<delete id="cartDel">
		delete from cart where pcode=#{pcode} and userid=#{userid}
	</delete>
	<update id="chgSu">
		update cart set su=#{su} where userid=#{userid} and pcode=#{pcode}
	</update>
	<select id="jjimList" resultType="kr.co.jk.dto.ProductDto">
		select p.* from product as p inner join jjim as j
		on p.pcode=j.pcode and j.userid=#{userid}
	</select>
	<insert id="addCart">
		insert into cart(pcode,userid,su,writeday)
		values(#{pcode},#{userid},1,now())
	</insert>
	<select id="isCart" resultType="Boolean">
		select count(*) from cart where useridd=#{userid} and pcode=#{pcode}
	</select>
	<delete id="jjimDel">
		delete from jjim where userid=#{userid} and pcode=#{pcode}
	</delete>
	<select id="jumunList" resultType="HashMap">
		select p.title, p.pimg, p.pcode , b.name , b.juso , g.chongPrice,
		g.id,g.isReview, g.state , g.su , g.useJuk , g.sudan ,g.writeday , g.jumuncode,
		g.jumuncode as jumun, (select count(*) from gumae where jumuncode=jumun) as cnt
		from gumae as g inner join product as p on g.pcode=p.pcode
		inner join baesong as b on g.baeId=b.id
		where g.userid=#{userid}  order by g.id desc;
	</select>
	<update id="chgState">
		update gumae set state=#{state} where id=#{id}
	</update>
	<select id="reviewWriteOk" parameterType="kr.co.jk.dto.ReviewDto">
		insert into review(star,content,oneLine,userid,pcode,writeday)
		values(#{star},#{content},#{oneLine},#{userid},#{pcode},now())
	</select>
	<select id="getReviewAvg" resultType="Double">
		select avg(star) from review where pcode=#{pcode}
	</select>
	<update id="setProduct">
		update product set star=#{star} , review=review+1
		where pcode=#{pcode}
	</update>
	<update id="chgIsReview">
		update gumae set isReview=1 where id=#{id}
	</update>
	
</mapper>